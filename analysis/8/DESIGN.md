# Investigation Dashboard Date Range Enhancement

## Problem / Metric

The Investigation Dashboard currently displays "Generated: [current timestamp]" in the subtitle, which doesn't provide meaningful context about the investigation case data. Users need to see the actual timeframe of the case data to understand the investigation's temporal scope.

**Current State**: Dashboard shows generation timestamp instead of case data timeframe
**Target State**: Dashboard displays the actual date range from the case dataset while keeping generation timestamp in footer

## Goal

Replace the "Generated:" timestamp in the dashboard subtitle with the actual date range from the investigation case data, providing investigators with immediate context about the temporal scope of their data.

## Scope (M/S/W)

### Must Have [M]
- [M] Extract date range from sessions data (`createddate`, `starttime`, `lastmodifydate` fields)
- [M] Replace subtitle "Generated:" with "Date Range:" showing case timeframe
- [M] Keep existing "Generated:" timestamp in the footer unchanged
- [M] Handle edge cases (missing dates, invalid dates, single-day cases)
- [M] Use human-readable date format (e.g., "Mar 15, 2023 - Apr 7, 2025")

### Should Have [S]
- [S] Show total timespan duration (e.g., "Date Range: Mar 15, 2023 - Apr 7, 2025 (757 days)")
- [S] Use smartest available date field (prefer `starttime`, fallback to `createddate`)
- [S] Handle timezone considerations for date display

### Won't Do [W]
- [W] Detailed temporal analysis or timeline visualization
- [W] Date filtering or interactive date controls
- [W] Timezone conversion or multiple timezone display

## Acceptance Criteria

| # | Given | When | Then |
|---|-------|------|------|
| 1 | Sessions with valid date fields | Dashboard is generated | Subtitle shows "Date Range: [earliest] - [latest]" instead of "Generated:" |
| 2 | Sessions with missing/invalid dates | Dashboard is generated | Subtitle shows "Date Range: Not Available" gracefully |
| 3 | Single-day investigation case | Dashboard is generated | Subtitle shows "Date Range: [single date]" appropriately |
| 4 | Any investigation case | Dashboard is generated | Footer still contains "Generated by investigate_case.py at [timestamp]" |
| 5 | Mixed date fields across sessions | Dashboard is generated | Uses earliest and latest dates from all available date fields |

## Technical Design

### Date Extraction Strategy

```python
def extract_date_range(sessions):
    """Extract date range from sessions data"""
    dates = []
    
    for session in sessions:
        # Prioritize starttime, fallback to createddate, then lastmodifydate
        for date_field in ['starttime', 'createddate', 'lastmodifydate']:
            date_str = session.get(date_field)
            if date_str and date_str != "":
                try:
                    # Parse ISO format: "2025-04-03T18:31:36.090Z"
                    date_obj = datetime.datetime.fromisoformat(date_str.replace('Z', '+00:00'))
                    dates.append(date_obj)
                    break  # Use first valid date found
                except (ValueError, AttributeError):
                    continue
    
    if not dates:
        return None, None
    
    return min(dates), max(dates)

def format_date_range(start_date, end_date):
    """Format date range for display"""
    if not start_date or not end_date:
        return "Not Available"
    
    # Format: "Mar 15, 2023 - Apr 7, 2025"
    if start_date.date() == end_date.date():
        return start_date.strftime("%b %d, %Y")
    else:
        return f"{start_date.strftime('%b %d, %Y')} - {end_date.strftime('%b %d, %Y')}"
```

### HTML Template Changes

**Current subtitle (line 479):**
```html
<p>ðŸ“Š {data_quality["total_sessions"]:,} communications analyzed | {quality_score:.0f}% data quality | Generated: {timestamp}</p>
```

**New subtitle:**
```html
<p>ðŸ“Š {data_quality["total_sessions"]:,} communications analyzed | {quality_score:.0f}% data quality | Date Range: {date_range}</p>
```

**Footer remains unchanged (line 619):**
```html
<p>Generated by investigate_case.py at {timestamp}</p>
```

## Implementation Steps

1. **Add date extraction function** - Create `extract_date_range()` function in `investigate_case.py`
2. **Add date formatting function** - Create `format_date_range()` helper function
3. **Modify `create_html_dashboard()` function** - Call date extraction and pass to template
4. **Update HTML template** - Replace "Generated:" with "Date Range:" in subtitle
5. **Add import for datetime parsing** - Ensure proper datetime handling
6. **Test edge cases** - Verify behavior with missing/invalid dates

## Testing Strategy

### Unit Tests
- Test `extract_date_range()` with various session data scenarios
- Test `format_date_range()` with edge cases (same day, missing dates, invalid dates)
- Verify HTML output contains correct date range string

### Integration Tests  
- Test with real case data (whiskey_jack, gantry datasets)
- Verify existing footer timestamp unchanged
- Test with sessions containing no date fields
- Test with sessions containing only partial date fields

### Manual Verification
- Generate dashboard for known case and verify date range accuracy
- Check that subtitle no longer shows generation time
- Confirm footer still shows generation timestamp

## Risks & Considerations

### Data Quality Risks
- Sessions may have missing or invalid date fields requiring graceful fallback
- Date formats may vary or be inconsistent across different data sources
- Timezone handling may need consideration for international investigations

### Implementation Risks
- Existing tests expect current "Generated:" format in subtitle
- Large datasets may impact performance if date extraction is inefficient
- Date parsing errors could break dashboard generation

### Mitigation Strategies
- Implement robust error handling and fallbacks for date parsing
- Update existing tests to expect new subtitle format
- Use efficient date extraction (early exit on first valid date per session)
- Provide clear fallback text when dates are unavailable

---

*Enhanced dashboard context through meaningful temporal information*